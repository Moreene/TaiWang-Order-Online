import{i as u,C as F,k as T,o as V,c as x,a as e,t as h,b as s,l as c,m as z,n as k,x as O,e as R,j as L,G as H,w as D,F as U,r as W,f as J,$ as K}from"./index-Acea3fQg.js";import{s as y,S as Q}from"./sweetalert-8fODVnWy.js";import{f as q,a as N}from"./date-8u4Ux2E5.js";import{a as E}from"./axios-G2rPRu76.js";import{M as j}from"./modal-qYYGS3Lr.js";var Z={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const G={class:"modal-dialog modal-dialog-centered modal-lg"},X={class:"modal-content border-0"},Y={class:"modal-header bg-primary text-white"},ee={id:"couponModalLabel",class:"modal-title"},te={class:"modal-body"},oe={class:"row"},le={class:"col-md-6"},ae={class:"mb-16"},ne=e("label",{for:"title",class:"form-label"},"優惠名稱",-1),se={class:"mb-16"},de=e("label",{for:"code",class:"form-label"},"優惠代碼",-1),ie={class:"mb-16"},ce=e("label",{for:"percent",class:"form-label"},"優惠%數",-1),ue={class:"col-md-6"},re={class:"mb-16"},pe=e("label",{for:"date",class:"form-label"},"到期日",-1),me=e("label",{for:"time",class:"form-label"},"到期時間",-1),_e={class:"modal-footer"},fe=e("button",{type:"submit",class:"btn btn-primary text-white w-25"}," 確認 ",-1),ve={__name:"CouponModalComponent",props:["tempCoupon","isNew"],emits:["update","clearInput","closeModal"],setup($,{expose:C,emit:w}){const{VITE_API:b,VITE_APIPATH:m}=Z,g=$,_=w,p=u(null),n=u({}),d=u(""),a=u(""),f=u(0),M=u(null);function P(o){return o?o<1?"優惠%數需大於 1 ":!0:"優惠%數 為必填"}function A(){const o=d.value+" "+a.value;f.value=Date.parse(o)}function B(){A();const o={...n.value,is_enabled:n.value.is_enabled?1:0,due_date:f.value};let t=`${b}/api/${m}/admin/coupon/${o.id}`,i="put";g.isNew&&(t=`${b}/api/${m}/admin/coupon`,i="post"),E[i](t,{data:o}).then(l=>{y("success",l.data.message),_("update"),_("clearInput"),_("closeModal")}).catch(l=>{console.log(l),y("error",l.response.data.message)})}function S(){M.value.resetForm()}return F(()=>g.tempCoupon,o=>{d.value=q(o.due_date),a.value=N(o.due_date),Object.assign(n.value,o)},{deep:!0}),C({couponModal:p,resetForm:S}),(o,t)=>{const i=T("v-field"),l=T("error-message"),I=T("v-form");return V(),x("div",{id:"couponModal",ref_key:"couponModal",ref:p,class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",G,[e("div",X,[e("div",Y,[e("h5",ee,h(s(n).title?s(n).title:"建立優惠券"),1),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=r=>o.$emit("clearInput"))})]),c(I,{ref_key:"form",ref:M,onSubmit:B},{default:z(({errors:r})=>[e("div",te,[e("div",oe,[e("div",le,[e("div",ae,[ne,c(i,{id:"title",name:"優惠名稱",type:"text",class:k(["form-control",{"is-invalid":r.優惠名稱}]),modelValue:s(n).title,"onUpdate:modelValue":t[1]||(t[1]=v=>s(n).title=v),placeholder:"請輸入優惠名稱",rules:"required"},null,8,["modelValue","class"]),c(l,{name:"優惠名稱",class:"invalid-feedback"})]),e("div",se,[de,c(i,{id:"code",name:"優惠代碼",type:"text",class:k(["form-control",{"is-invalid":r.優惠代碼}]),modelValue:s(n).code,"onUpdate:modelValue":t[2]||(t[2]=v=>s(n).code=v),placeholder:"請輸入優惠代碼",rules:"required"},null,8,["modelValue","class"]),c(l,{name:"優惠代碼",class:"invalid-feedback"})]),e("div",ie,[ce,c(i,{id:"percent",name:"優惠%數",type:"number",class:k(["form-control",{"is-invalid":r["優惠%數"]}]),modelValue:s(n).percent,"onUpdate:modelValue":t[3]||(t[3]=v=>s(n).percent=v),modelModifiers:{number:!0},placeholder:"請輸入優惠%數",rules:P},null,8,["modelValue","class"]),c(l,{name:"優惠%數",class:"invalid-feedback"})])]),e("div",ue,[e("div",re,[pe,c(i,{id:"date",name:"到期日",type:"date",class:k(["form-control",{"is-invalid":r.到期日}]),modelValue:s(d),"onUpdate:modelValue":t[4]||(t[4]=v=>O(d)?d.value=v:null),rules:"required"},null,8,["modelValue","class"]),c(l,{name:"到期日",class:"invalid-feedback"})]),e("div",null,[me,c(i,{id:"time",name:"到期時間",type:"time",class:k(["form-control",{"is-invalid":r.到期時間}]),modelValue:s(a),"onUpdate:modelValue":t[5]||(t[5]=v=>O(a)?a.value=v:null),rules:"required"},null,8,["modelValue","class"]),c(l,{name:"到期時間",class:"invalid-feedback"})])])])]),e("div",_e,[e("button",{type:"button",class:"btn btn-outline-primary w-25","data-bs-dismiss":"modal",onClick:t[6]||(t[6]=v=>o.$emit("clearInput"))}," 取消 "),fe])]),_:1},512)])])],512)}}};var be={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const he={class:"modal-dialog modal-dialog-centered"},$e={class:"modal-content border-0"},Ce={class:"modal-header bg-danger text-white"},we={id:"delCouponModalLabel",class:"modal-title"},ge=e("i",{class:"bi bi-exclamation-circle"},null,-1),Me={class:"modal-body text-center p-24"},ye={class:"fs-5"},Ie={class:"modal-footer border-0 justify-content-center"},ke={__name:"DelCouponModalComponent",props:["tempCoupon"],emits:["update","clearInput","closeModal"],setup($,{expose:C,emit:w}){const{VITE_API:b,VITE_APIPATH:m}=be,g=$,_=w,p=u(null);function n(){E.delete(`${b}/api/${m}/admin/coupon/${g.tempCoupon.id}`).then(d=>{y("success",d.data.message),_("update"),_("closeModal")}).catch(d=>{console.log(d),y("error",d.response.data.message)})}return C({delCouponModal:p}),(d,a)=>(V(),x("div",{id:"delCouponModal",ref_key:"delCouponModal",ref:p,class:"modal fade",tabindex:"-1","aria-labelledby":"delCouponModalLabel","aria-hidden":"true"},[e("div",he,[e("div",$e,[e("div",Ce,[e("h5",we,[e("span",null,[ge,R(" "+h($.tempCoupon.title),1)])]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:a[0]||(a[0]=f=>d.$emit("clearInput"))})]),e("div",Me,[e("span",ye,'是否要刪除 "'+h($.tempCoupon.title)+'" 優惠券 ？',1)]),e("div",Ie,[e("button",{type:"button",class:"btn btn-outline-danger w-25","data-bs-dismiss":"modal",onClick:a[1]||(a[1]=f=>d.$emit("clearInput"))}," 取消 "),e("button",{type:"button",class:"btn btn-danger w-25",onClick:n}," 確認 ")])])])],512))}};var Ve={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const xe={class:"container py-144"},Pe=e("h2",{class:"fw-bold mb-32"},"優惠列表",-1),Ae={class:"text-end mb-24"},Te=e("i",{class:"bi bi-plus"},null,-1),Ee={class:"table-responsive mb-16"},Be={class:"table align-middle"},Se=e("thead",{class:"text-nowrap"},[e("tr",{class:"text-nowrap text-center border-dark"},[e("th",{width:"120"}," 優惠名稱 "),e("th",{width:"120"}," 優惠代碼 "),e("th",{width:"120"}," 優惠%數 "),e("th",{width:"120"}," 到期日 "),e("th",{width:"120"}," 到期時間 "),e("th",{width:"100"}," 是否啟用 "),e("th",{width:"120"}," 編輯 "),e("th",{width:"120"}," 刪除 ")])],-1),De={class:"text-nowrap text-center"},Oe={class:"form-check form-switch d-flex justify-content-center"},Le=["onUpdate:modelValue","onChange"],Ue=["onClick"],je=e("i",{class:"bi bi-pencil-square fs-5"},null,-1),Re=[je],qe=["onClick"],Ne=e("i",{class:"bi bi-trash3 fs-5"},null,-1),Fe=[Ne],Qe={__name:"AdminCouponView",setup($){const{VITE_API:C,VITE_APIPATH:w}=Ve,b=u([]),m=u({}),g=u({}),_=u(!1),p=u(!1);function n(o=1){p.value=!0,E.get(`${C}/api/${w}/admin/coupons?page=${o}`).then(t=>{g.value=t.data.pagination;const i=t.data.coupons;b.value=i.map(l=>({...l,is_enabled:l.is_enabled===1})),p.value=!1}).catch(t=>{p.value=!1,y("error",t.response.data.message)})}function d(o){const t=!o.is_enabled,i=Q.mixin({customClass:{confirmButton:"btn btn-secondary text-light",cancelButton:"btn btn-outline-secondary me-16"},buttonsStyling:!1});i.fire({title:"是否要更新啟用狀態？",icon:"warning",showCancelButton:!0,confirmButtonText:"是, 我要更新",cancelButtonText:"我再想想",reverseButtons:!0}).then(l=>{if(l.isConfirmed){const r={...o,is_enabled:!t?1:0};E.put(`${C}/api/${w}/admin/coupon/${o.id}`,{data:r}).then(()=>{i.fire({title:`已更新 ${o.title} 的啟用狀態`,icon:"success",showConfirmButton:!1,timer:2e3})}).catch(()=>{console.log(err),y("error","更新啟用狀態失敗")})}else o.is_enabled=t})}const a=u(null),f=u(null);function M(o,t){o==="new"?(m.value={},_.value=!0,a.value.couponModal.value.show()):o==="edit"?(m.value={...t},_.value=!1,a.value.couponModal.value.show()):o==="delete"&&(m.value={...t},_.value=!1,f.value.delCouponModal.value.show())}function P(){m.value={due_date:0},a.value.resetForm()}function A(){a.value.couponModal.value.hide(),f.value.delCouponModal.value.hide()}const B=L(()=>b.value.map(o=>q(o.due_date))),S=L(()=>b.value.map(o=>N(o.due_date)));return H(()=>{n(),a.value.couponModal.value=new j(a.value.couponModal,{keyboard:!1}),f.value.delCouponModal.value=new j(f.value.delCouponModal,{keyboard:!1})}),(o,t)=>{const i=T("VueLoading");return V(),x(U,null,[c(i,{active:s(p),"onUpdate:active":t[0]||(t[0]=l=>O(p)?p.value=l:null),loader:"bars",color:"#ff9900"},null,8,["active"]),e("div",xe,[Pe,e("div",Ae,[e("button",{type:"button",class:"btn btn-primary text-light",onClick:t[1]||(t[1]=D(l=>M("new",o.item),["prevent"]))},[R(" 建立新優惠 "),Te])]),e("div",Ee,[e("table",Be,[Se,e("tbody",De,[(V(!0),x(U,null,W(s(b),(l,I)=>(V(),x("tr",{key:l.id},[e("td",null,h(l.title),1),e("td",null,h(l.code),1),e("td",null,h(l.percent),1),e("td",null,h(s(B)[I]),1),e("td",null,h(s(S)[I]),1),e("td",null,[e("div",Oe,[J(e("input",{class:"form-check-input",type:"checkbox",role:"switch",style:{height:"20px"},"onUpdate:modelValue":r=>l.is_enabled=r,onChange:r=>d(l)},null,40,Le),[[K,l.is_enabled]])])]),e("td",null,[e("a",{href:"#",class:"link-primary",onClick:D(r=>M("edit",l),["prevent"])},Re,8,Ue)]),e("td",null,[e("a",{href:"#",class:"link-danger",onClick:D(r=>M("delete",l),["prevent"])},Fe,8,qe)])]))),128))])])])]),c(ve,{ref_key:"modal",ref:a,"temp-coupon":s(m),"is-new":s(_),onClearInput:P,onCloseModal:A,onUpdate:n},null,8,["temp-coupon","is-new"]),c(ke,{ref_key:"delModal",ref:f,"temp-coupon":s(m),onClearInput:P,onCloseModal:A,onUpdate:n},null,8,["temp-coupon"])],64)}}};export{Qe as default};
