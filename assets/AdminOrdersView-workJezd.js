import{i as m,j as D,C as R,k as A,o as r,c as u,a as e,t as a,b as s,l as y,m as j,e as z,f as k,v as V,n as U,$ as F,d as P,F as w,r as S,G as q,x as H,M as J,w as L}from"./index-qkiaYoID.js";import{f as N}from"./date-8u4Ux2E5.js";import{s as $}from"./sweetalert--HSzbr_G.js";import{a as E}from"./axios-G2rPRu76.js";import{_ as K}from"./AdminPaginationComponent-BcOHm1MH.js";import{M as B}from"./modal-g4mfpVP8.js";var Q={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const W={class:"modal-dialog modal-dialog-centered modal-xl"},Z={class:"modal-content border-0"},G={class:"modal-header bg-primary text-white"},X={id:"editOrderModalLabel",class:"modal-title"},Y={class:"modal-body"},ee={class:"h5 fw-bold"},te={class:"d-block d-sm-inline"},se={class:"h5 fw-bold"},oe={class:"row py-24"},le={class:"col-lg-6"},ae={key:0,class:"row gy-16"},de={class:"col-md-6"},ne=e("label",{for:"people",class:"form-label"},"訂購人",-1),re={class:"col-md-6"},ie=e("label",{for:"phone",class:"form-label"},"手機",-1),ce={class:"col-md-6"},ue=e("label",{for:"mail",class:"form-label"},"信箱",-1),_e={class:"col-md-6"},me=e("label",{for:"address",class:"form-label"},"地址",-1),pe={class:"col-12"},he=e("label",{for:"extarea"},"留言",-1),fe={key:0,class:"col-12"},ve={class:"form-check"},be=e("label",{class:"form-check-label",for:"check"}," 已付款 ",-1),Oe={class:"col-lg-6"},ye={key:0},Me=e("hr",{class:"my-8"},null,-1),ge={class:"ps-16 py-8"},ke=e("hr",{class:"my-8"},null,-1),$e={class:"modal-footer"},xe=e("button",{type:"submit",class:"btn btn-primary text-white w-20"}," 確認 ",-1),Ie={__name:"OrderModalComponent",props:["tempOrder"],emits:["updateOrder","clearInput","closeModal"],setup(b,{expose:M,emit:g}){const{VITE_API:v,VITE_APIPATH:p}=Q,h=b,n=g,t=m({}),_=m(null);function i(){E.put(`${v}/api/${p}/admin/order/${h.tempOrder.id}`,{data:t.value}).then(f=>{$("success",f.data.message),n("updateOrder"),n("clearInput"),n("closeModal")}).catch(f=>{$("error",f.response.data.message)})}const O=m(null);function T(){O.value.resetForm()}const x=D(()=>N(t.value.paid_date*1e3));return R(()=>h.tempOrder,()=>{t.value=JSON.parse(JSON.stringify(h.tempOrder))}),M({editOrderModal:_,resetForm:T}),(f,o)=>{const c=A("v-field"),C=A("error-message"),d=A("v-form");return r(),u("div",{id:"editOrderModal",ref_key:"editOrderModal",ref:_,class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true"},[e("div",W,[e("div",Z,[e("div",G,[e("h5",X,[e("span",null,a(s(t).id),1)]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:o[0]||(o[0]=I=>f.$emit("clearInput"))})]),e("div",Y,[y(d,{ref_key:"form",ref:O,onSubmit:i},{default:j(({errors:I})=>[e("h2",ee,[z("訂單編號："),e("span",te,a(s(t).id),1)]),e("h2",se,"訂單日期："+a(s(t).paid_date?s(x):"未成立"),1),e("div",oe,[e("div",le,[s(t).user?(r(),u("div",ae,[e("div",de,[ne,k(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=l=>s(t).user.name=l),readonly:""},null,512),[[V,s(t).user.name]])]),e("div",re,[ie,k(e("input",{id:"phone",type:"tel",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=l=>s(t).user.tel=l),readonly:""},null,512),[[V,s(t).user.tel]])]),e("div",ce,[ue,k(e("input",{id:"mail",type:"email",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=l=>s(t).user.email=l),readonly:""},null,512),[[V,s(t).user.email]])]),e("div",_e,[me,y(c,{id:"address",name:"地址",type:"text",class:U(["form-control",{"is-invalid":I.地址}]),modelValue:s(t).user.address,"onUpdate:modelValue":o[4]||(o[4]=l=>s(t).user.address=l),rules:"required"},null,8,["modelValue","class"]),y(C,{name:"地址",class:"invalid-feedback"})]),e("div",pe,[he,k(e("textarea",{class:"form-control",id:"extarea",style:{height:"100px"},"onUpdate:modelValue":o[5]||(o[5]=l=>s(t).message=l)},null,512),[[V,s(t).message]])]),s(t).is_paid?P("",!0):(r(),u("div",fe,[e("div",ve,[k(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=l=>s(t).is_paid=l),id:"check"},null,512),[[F,s(t).is_paid]]),be])]))])):P("",!0)]),e("div",Oe,[s(t)&&s(t).products?(r(),u("div",ye," 訂購內容 ("+a(Object.keys(s(t).products).length)+") ",1)):P("",!0),Me,e("ol",ge,[(r(!0),u(w,null,S(s(t).products,l=>(r(),u("li",{key:l.id},a(l.product.title)+" x "+a(l.qty),1))),128))]),ke,e("p",null,"總金額：NT$ "+a(Math.round(s(t).total)),1)])]),e("div",$e,[e("button",{type:"button",class:"btn btn-outline-primary w-20 me-16","data-bs-dismiss":"modal",onClick:o[7]||(o[7]=l=>f.$emit("clearInput"))}," 取消 "),xe])]),_:1},512)])])])],512)}}};var Ve={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Ae={class:"modal-dialog modal-dialog-centered"},Pe={class:"modal-content border-0"},we={class:"modal-header bg-danger text-white"},Ee={id:"delOrderModalLabel",class:"modal-title"},Te=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ce={class:"modal-body text-center p-24"},Se={class:"fs-5"},Le=e("button",{type:"button",class:"btn btn-outline-danger w-25","data-bs-dismiss":"modal"}," 取消 ",-1),Be={__name:"DelOrderModalComponent",props:["tempOrder"],emits:["updateOrder","closeModal"],setup(b,{expose:M,emit:g}){const{VITE_API:v,VITE_APIPATH:p}=Ve,h=b,n=g,t=m(null);function _(){E.delete(`${v}/api/${p}/admin/order/${h.tempOrder.id}`).then(i=>{$("success",i.data.message),n("updateOrder"),n("closeModal")}).catch(i=>{$("error",i.response.data.message)})}return M({delOrderModal:t}),(i,O)=>(r(),u("div",{id:"delOrderModal",ref_key:"delOrderModal",ref:t,class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},[e("div",Ae,[e("div",Pe,[e("div",we,[e("h5",Ee,[e("span",null,a(b.tempOrder.id),1)]),Te]),e("div",Ce,[e("span",Se,'是否要刪除 "'+a(b.tempOrder.id)+'" 訂單?',1)]),e("div",{class:"modal-footer border-0 justify-content-center"},[Le,e("button",{type:"button",class:"btn btn-danger w-25",onClick:_}," 確認刪除 ")])])])],512))}};var De={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Ue={class:"container py-144"},Ne=e("h2",{class:"fw-bold mb-32"},"訂單列表",-1),Re={class:"table-responsive mb-16"},je={class:"table align-middle"},ze=e("thead",{class:"text-nowrap"},[e("tr",{class:"text-nowrap text-center border-dark"},[e("th",null," 成立日期 "),e("th",{width:"300"}," 訂單編號 "),e("th",null," 訂購人 "),e("th",null," 手機 "),e("th",null," 訂單內容 "),e("th",null," 總計 "),e("th",null," 付款 "),e("th",null," 編輯 "),e("th",null," 刪除 ")])],-1),Fe={class:"text-nowrap text-center"},qe={class:"ps-0 mb-0 list-unstyled text-center"},He=["onClick"],Je=e("i",{class:"bi bi-pencil-square fs-5"},null,-1),Ke=[Je],Qe=["onClick"],We=e("i",{class:"bi bi-trash3 fs-5"},null,-1),Ze=[We],ot={__name:"AdminOrdersView",setup(b){const{VITE_API:M,VITE_APIPATH:g}=De,v=m([]),p=m({}),h=m({}),n=m(!1);function t(o=1){n.value=!0,E.get(`${M}/api/${g}/admin/orders?page=${o}`).then(c=>{v.value=c.data.orders,h.value=c.data.pagination,n.value=!1}).catch(c=>{n.value=!1,$("error",c.response.data.message)})}const _=m(null),i=m(null);function O(o,c){o==="edit"?(p.value={...c},_.value.editOrderModal.value.show()):o==="delete"&&(p.value={...c},i.value.delOrderModal.value.show())}function T(){p.value={},_.value.resetForm()}function x(){_.value.editOrderModal.value.hide(),i.value.delOrderModal.value.hide()}const f=D(()=>v.value.map(o=>N(o.paid_date*1e3)));return q(()=>{const o=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");E.defaults.headers.common.Authorization=o,_.value.editOrderModal.value=new B(_.value.editOrderModal,{keyboard:!1}),i.value.delOrderModal.value=new B(i.value.delOrderModal,{keyboard:!1}),t()}),(o,c)=>{const C=A("VueLoading");return r(),u(w,null,[y(C,{active:s(n),"onUpdate:active":c[0]||(c[0]=d=>H(n)?n.value=d:null),loader:"bars",color:"#ff9900"},null,8,["active"]),e("div",Ue,[Ne,e("div",Re,[e("table",je,[ze,e("tbody",Fe,[(r(!0),u(w,null,S(s(v),(d,I)=>(r(),u("tr",{key:d.id},[e("td",null,a(d.paid_date?s(f)[I]:"未成立"),1),e("td",null,a(d.id),1),e("td",null,a(d.user.name),1),e("td",null,a(d.user.tel),1),e("td",null,[e("ul",qe,[(r(!0),u(w,null,S(d.products,l=>(r(),u("li",{key:l.product_id},a(l.product.title)+" * "+a(l.qty),1))),128))])]),e("td",null,"$ "+a(Math.round(d.total)),1),e("td",null,[e("span",{class:U({"text-danger":d.is_paid===!1})},a(d.is_paid?"已付款":"未付款"),3)]),e("td",null,[e("a",{href:"#",class:"link-primary",onClick:L(l=>O("edit",d),["prevent"])},Ke,8,He)]),e("td",null,[e("a",{href:"#",class:"link-danger",onClick:L(l=>O("delete",d),["prevent"])},Ze,8,Qe)])]))),128))])])]),s(h).total_pages>1?(r(),J(K,{key:0,pagination:s(h),onEmitPages:t},null,8,["pagination"])):P("",!0),y(Ie,{ref_key:"modal",ref:_,"temp-order":s(p),onClearInput:T,onCloseModal:x,onUpdateOrder:t},null,8,["temp-order"]),y(Be,{ref_key:"delModal",ref:i,"temp-order":s(p),onCloseModal:x,onUpdateOrder:t},null,8,["temp-order"])])],64)}}};export{ot as default};
