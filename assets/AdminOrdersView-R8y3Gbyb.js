import{a as v}from"./axios-G2rPRu76.js";import{M as x,A as $}from"./AdminPaginationComponent-37itcCt-.js";import{f as V}from"./date-8u4Ux2E5.js";import{s as u}from"./sweetalert-n2cD1G8m.js";import{_ as P,h as i,o as a,c as n,b as e,t as d,i as c,j as w,e as C,f as p,v as b,n as E,V as L,d as O,F as g,r as M,J as S,w as A}from"./index-cKTOsiM9.js";var D={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:U,VITE_APIPATH:B}=D,N={props:["tempOrder"],data(){return{order:{},editOrderModal:null}},methods:{updateOrder(){v.put(`${U}/api/${B}/admin/order/${this.tempOrder.id}`,{data:this.order}).then(r=>{u("success",r.data.message),this.$emit("updateOrder"),this.$emit("clearInput"),this.editOrderModal.hide()}).catch(r=>{u("error",r.response.data.message)})},resetForm(){this.$refs.form.resetForm()}},computed:{date(){return V(this.order.paid_date*1e3)}},watch:{tempOrder(){this.order=JSON.parse(JSON.stringify(this.tempOrder))}},mounted(){this.editOrderModal=new x(this.$refs.editOrderModal,{keyboard:!1,backdrop:"static"})}},j={id:"editOrderModal",ref:"editOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-dialog-centered modal-xl"},z={class:"modal-content border-0"},F={class:"modal-header bg-primary text-white"},H={id:"editOrderModalLabel",class:"modal-title"},q={class:"modal-body"},J={class:"h5 fw-bold"},K={class:"d-block d-sm-inline"},Q={class:"h5 fw-bold"},W={class:"row py-24"},Z={class:"col-lg-6"},G={key:0,class:"row gy-16"},X={class:"col-md-6"},Y=e("label",{for:"people",class:"form-label"},"訂購人",-1),ee={class:"col-md-6"},te=e("label",{for:"phone",class:"form-label"},"手機",-1),oe={class:"col-md-6"},se=e("label",{for:"mail",class:"form-label"},"信箱",-1),re={class:"col-md-6"},de=e("label",{for:"address",class:"form-label"},"地址",-1),le={class:"col-12"},ae=e("label",{for:"extarea"},"留言",-1),ne={key:0,class:"col-12"},ie={class:"form-check"},ce=e("label",{class:"form-check-label",for:"check"}," 已付款 ",-1),_e={class:"col-lg-6"},me={key:0},pe=e("hr",{class:"my-8"},null,-1),ue={class:"ps-16 py-8"},he=e("hr",{class:"my-8"},null,-1),fe={class:"modal-footer"},be=e("button",{type:"submit",class:"btn btn-primary text-white w-20"}," 確認 ",-1);function Oe(r,o,h,k,t,l){const _=i("v-field"),y=i("error-message"),I=i("v-form");return a(),n("div",j,[e("div",R,[e("div",z,[e("div",F,[e("h5",H,[e("span",null,d(t.order.id),1)]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:o[0]||(o[0]=f=>r.$emit("clearInput"))})]),e("div",q,[c(I,{ref:"form",onSubmit:l.updateOrder},{default:w(({errors:f})=>[e("h2",J,[C("訂單編號："),e("span",K,d(t.order.id),1)]),e("h2",Q,"訂單日期："+d(t.order.paid_date?l.date:"未成立"),1),e("div",W,[e("div",Z,[t.order.user?(a(),n("div",G,[e("div",X,[Y,p(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>t.order.user.name=s),readonly:""},null,512),[[b,t.order.user.name]])]),e("div",ee,[te,p(e("input",{id:"phone",type:"tel",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>t.order.user.tel=s),readonly:""},null,512),[[b,t.order.user.tel]])]),e("div",oe,[se,p(e("input",{id:"mail",type:"email",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>t.order.user.email=s),readonly:""},null,512),[[b,t.order.user.email]])]),e("div",re,[de,c(_,{id:"address",name:"地址",type:"text",class:E(["form-control",{"is-invalid":f.地址}]),modelValue:t.order.user.address,"onUpdate:modelValue":o[4]||(o[4]=s=>t.order.user.address=s),rules:"required"},null,8,["modelValue","class"]),c(y,{name:"地址",class:"invalid-feedback"})]),e("div",le,[ae,p(e("textarea",{class:"form-control",id:"extarea",style:{height:"100px"},"onUpdate:modelValue":o[5]||(o[5]=s=>t.order.message=s)},null,512),[[b,t.order.message]])]),t.order.is_paid?O("",!0):(a(),n("div",ne,[e("div",ie,[p(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=s=>t.order.is_paid=s),id:"check"},null,512),[[L,t.order.is_paid]]),ce])]))])):O("",!0)]),e("div",_e,[t.order&&t.order.products?(a(),n("div",me," 訂購內容 ("+d(Object.keys(t.order.products).length)+") ",1)):O("",!0),pe,e("ol",ue,[(a(!0),n(g,null,M(t.order.products,s=>(a(),n("li",{key:s.id},d(s.product.title)+" x "+d(s.qty),1))),128))]),he,e("p",null,"總金額：NT$ "+d(Math.round(t.order.total)),1)])]),e("div",fe,[e("button",{type:"button",class:"btn btn-outline-primary w-20 me-16","data-bs-dismiss":"modal",onClick:o[7]||(o[7]=s=>r.$emit("clearInput"))}," 取消 "),be])]),_:1},8,["onSubmit"])])])])],512)}const ge=P(N,[["render",Oe]]);var ve={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:ye,VITE_APIPATH:Ie}=ve,Me={props:["tempOrder"],data(){return{delOrderModal:null}},methods:{delProduct(){v.delete(`${ye}/api/${Ie}/admin/order/${this.tempOrder.id}`).then(r=>{u("success",r.data.message),this.$emit("updateOrder"),this.delOrderModal.hide()}).catch(r=>{u("error",r.response.data.message)})}},mounted(){this.delOrderModal=new x(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})}},Pe={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},ke={class:"modal-dialog modal-dialog-centered"},Ae={class:"modal-content border-0"},xe={class:"modal-header bg-danger text-white"},Ve={id:"delOrderModalLabel",class:"modal-title"},Ee=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Te={class:"modal-body text-center p-24"},$e={class:"fs-5"},we={class:"modal-footer border-0 justify-content-center"},Ce=e("button",{type:"button",class:"btn btn-outline-danger w-25","data-bs-dismiss":"modal"}," 取消 ",-1);function Le(r,o,h,k,t,l){return a(),n("div",Pe,[e("div",ke,[e("div",Ae,[e("div",xe,[e("h5",Ve,[e("span",null,d(h.tempOrder.id),1)]),Ee]),e("div",Te,[e("span",$e,'是否要刪除 "'+d(h.tempOrder.id)+'" 訂單?',1)]),e("div",we,[Ce,e("button",{type:"button",class:"btn btn-danger w-25",onClick:o[0]||(o[0]=(..._)=>l.delProduct&&l.delProduct(..._))}," 確認刪除 ")])])])],512)}const Se=P(Me,[["render",Le]]);var De={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:Ue,VITE_APIPATH:Be}=De,Ne={components:{OrderModalComponent:ge,DelOrderModalComponent:Se,AdminPaginationComponent:$},data(){return{orders:[],tempOrder:{},pagination:{},isLoading:!1}},methods:{getOrders(r=1){this.isLoading=!0,v.get(`${Ue}/api/${Be}/admin/orders?page=${r}`).then(o=>{this.orders=o.data.orders,this.pagination=o.data.pagination,this.isLoading=!1}).catch(o=>{this.isLoading=!1,u("error",o.response.data.message)})},openModal(r,o){r==="edit"?(this.tempOrder={...o},this.$refs.modal.editOrderModal.show()):r==="delete"&&(this.tempOrder={...o},this.$refs.delModal.delOrderModal.show())},clearInput(){this.tempOrder={},this.$refs.modal.resetForm()}},computed:{date(){return this.orders.map(r=>V(r.paid_date*1e3))}},mounted(){const r=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");v.defaults.headers.common.Authorization=r,this.getOrders()}},je={class:"container py-144"},Re=e("h2",{class:"fw-bold mb-32"},"訂單列表",-1),ze={class:"table-responsive mb-16"},Fe={class:"table align-middle"},He=e("thead",{class:"text-nowrap"},[e("tr",{class:"text-nowrap text-center border-dark"},[e("th",null," 成立日期 "),e("th",{width:"300"}," 訂單編號 "),e("th",null," 訂購人 "),e("th",null," 手機 "),e("th",null," 訂單內容 "),e("th",null," 總計 "),e("th",null," 付款 "),e("th",null," 編輯 "),e("th",null," 刪除 ")])],-1),qe={class:"text-nowrap text-center"},Je={class:"ps-0 mb-0 list-unstyled text-center"},Ke=["onClick"],Qe=e("i",{class:"bi bi-pencil-square fs-5"},null,-1),We=[Qe],Ze=["onClick"],Ge=e("i",{class:"bi bi-trash3 fs-5"},null,-1),Xe=[Ge];function Ye(r,o,h,k,t,l){const _=i("VueLoading"),y=i("AdminPaginationComponent"),I=i("OrderModalComponent"),f=i("DelOrderModalComponent");return a(),n(g,null,[c(_,{active:t.isLoading,"onUpdate:active":o[0]||(o[0]=s=>t.isLoading=s),loader:"bars",color:"#ff9900"},null,8,["active"]),e("div",je,[Re,e("div",ze,[e("table",Fe,[He,e("tbody",qe,[(a(!0),n(g,null,M(t.orders,(s,T)=>(a(),n("tr",{key:s.id},[e("td",null,d(s.paid_date?l.date[T]:"未成立"),1),e("td",null,d(s.id),1),e("td",null,d(s.user.name),1),e("td",null,d(s.user.tel),1),e("td",null,[e("ul",Je,[(a(!0),n(g,null,M(s.products,m=>(a(),n("li",{key:m.product_id},d(m.product.title)+" * "+d(m.qty),1))),128))])]),e("td",null,"$ "+d(Math.round(s.total)),1),e("td",null,[e("span",{class:E({"text-danger":s.is_paid===!1})},d(s.is_paid?"已付款":"未付款"),3)]),e("td",null,[e("a",{href:"#",class:"link-primary",onClick:A(m=>l.openModal("edit",s),["prevent"])},We,8,Ke)]),e("td",null,[e("a",{href:"#",class:"link-danger",onClick:A(m=>l.openModal("delete",s),["prevent"])},Xe,8,Ze)])]))),128))])])]),t.pagination.total_pages>1?(a(),S(y,{key:0,pagination:t.pagination,onEmitPages:l.getOrders},null,8,["pagination","onEmitPages"])):O("",!0),c(I,{ref:"modal","temp-order":t.tempOrder,onClearInput:l.clearInput,onUpdateOrder:l.getOrders},null,8,["temp-order","onClearInput","onUpdateOrder"]),c(f,{ref:"delModal","temp-order":t.tempOrder,onUpdateOrder:l.getOrders},null,8,["temp-order","onUpdateOrder"])])],64)}const dt=P(Ne,[["render",Ye]]);export{dt as default};
