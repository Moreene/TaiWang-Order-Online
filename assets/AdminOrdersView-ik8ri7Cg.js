import{i as _,j as B,C as N,k as V,o as d,c,a as e,t as s,l as O,m as j,e as R,f as g,v as I,n as D,$ as z,d as A,F as P,r as C,G as F,M as q,w as S}from"./index-WXTl0fys.js";import{a as w}from"./axios-G2rPRu76.js";import{f as U}from"./date-8u4Ux2E5.js";import{s as k}from"./sweetalert-7F7hic-m.js";import{_ as H}from"./AdminPaginationComponent-zoKQdD91.js";import{M as L}from"./modal-xX8eXMDc.js";var J={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const K={class:"modal-dialog modal-dialog-centered modal-xl"},Q={class:"modal-content border-0"},W={class:"modal-header bg-primary text-white"},Z={id:"editOrderModalLabel",class:"modal-title"},G={class:"modal-body"},X={class:"h5 fw-bold"},Y={class:"d-block d-sm-inline"},ee={class:"h5 fw-bold"},te={class:"row py-24"},le={class:"col-lg-6"},ae={key:0,class:"row gy-16"},se={class:"col-md-6"},oe=e("label",{for:"people",class:"form-label"},"訂購人",-1),de={class:"col-md-6"},ne=e("label",{for:"phone",class:"form-label"},"手機",-1),re={class:"col-md-6"},ie=e("label",{for:"mail",class:"form-label"},"信箱",-1),ce={class:"col-md-6"},ue=e("label",{for:"address",class:"form-label"},"地址",-1),_e={class:"col-12"},me=e("label",{for:"extarea"},"留言",-1),pe={key:0,class:"col-12"},ve={class:"form-check"},he=e("label",{class:"form-check-label",for:"check"}," 已付款 ",-1),fe={class:"col-lg-6"},be={key:0},Oe=e("hr",{class:"my-8"},null,-1),ye={class:"ps-16 py-8"},Me=e("hr",{class:"my-8"},null,-1),ge={class:"modal-footer"},ke=e("button",{type:"submit",class:"btn btn-primary text-white w-20"}," 確認 ",-1),$e={__name:"OrderModalComponent",props:["tempOrder"],emits:["updateOrder","clearInput","closeModal"],setup(f,{expose:y,emit:M}){const{VITE_API:h,VITE_APIPATH:m}=J,p=f,n=M,t=_({}),u=_(null);function r(){w.put(`${h}/api/${m}/admin/order/${p.tempOrder.id}`,{data:t.value}).then(v=>{k("success",v.data.message),n("updateOrder"),n("clearInput"),n("closeModal")}).catch(v=>{k("error",v.response.data.message)})}const b=_(null);function E(){b.value.resetForm()}const $=B(()=>U(t.value.paid_date*1e3));return N(()=>p.tempOrder,()=>{t.value=JSON.parse(JSON.stringify(p.tempOrder))}),y({editOrderModal:u,resetForm:E}),(v,l)=>{const i=V("v-field"),T=V("error-message"),o=V("v-form");return d(),c("div",{id:"editOrderModal",ref_key:"editOrderModal",ref:u,class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true"},[e("div",K,[e("div",Q,[e("div",W,[e("h5",Z,[e("span",null,s(t.value.id),1)]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:l[0]||(l[0]=x=>v.$emit("clearInput"))})]),e("div",G,[O(o,{ref_key:"form",ref:b,onSubmit:r},{default:j(({errors:x})=>[e("h2",X,[R("訂單編號："),e("span",Y,s(t.value.id),1)]),e("h2",ee,"訂單日期："+s(t.value.paid_date?$.value:"未成立"),1),e("div",te,[e("div",le,[t.value.user?(d(),c("div",ae,[e("div",se,[oe,g(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":l[1]||(l[1]=a=>t.value.user.name=a),readonly:""},null,512),[[I,t.value.user.name]])]),e("div",de,[ne,g(e("input",{id:"phone",type:"tel",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=a=>t.value.user.tel=a),readonly:""},null,512),[[I,t.value.user.tel]])]),e("div",re,[ie,g(e("input",{id:"mail",type:"email",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=a=>t.value.user.email=a),readonly:""},null,512),[[I,t.value.user.email]])]),e("div",ce,[ue,O(i,{id:"address",name:"地址",type:"text",class:D(["form-control",{"is-invalid":x.地址}]),modelValue:t.value.user.address,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.user.address=a),rules:"required"},null,8,["modelValue","class"]),O(T,{name:"地址",class:"invalid-feedback"})]),e("div",_e,[me,g(e("textarea",{class:"form-control",id:"extarea",style:{height:"100px"},"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.message=a)},null,512),[[I,t.value.message]])]),t.value.is_paid?A("",!0):(d(),c("div",pe,[e("div",ve,[g(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[6]||(l[6]=a=>t.value.is_paid=a),id:"check"},null,512),[[z,t.value.is_paid]]),he])]))])):A("",!0)]),e("div",fe,[t.value&&t.value.products?(d(),c("div",be," 訂購內容 ("+s(Object.keys(t.value.products).length)+") ",1)):A("",!0),Oe,e("ol",ye,[(d(!0),c(P,null,C(t.value.products,a=>(d(),c("li",{key:a.id},s(a.product.title)+" x "+s(a.qty),1))),128))]),Me,e("p",null,"總金額：NT$ "+s(Math.round(t.value.total)),1)])]),e("div",ge,[e("button",{type:"button",class:"btn btn-outline-primary w-20 me-16","data-bs-dismiss":"modal",onClick:l[7]||(l[7]=a=>v.$emit("clearInput"))}," 取消 "),ke])]),_:1},512)])])])],512)}}};var xe={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Ie={class:"modal-dialog modal-dialog-centered"},Ve={class:"modal-content border-0"},Ae={class:"modal-header bg-danger text-white"},Pe={id:"delOrderModalLabel",class:"modal-title"},we=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ee={class:"modal-body text-center p-24"},Te={class:"fs-5"},Ce=e("button",{type:"button",class:"btn btn-outline-danger w-25","data-bs-dismiss":"modal"}," 取消 ",-1),Se={__name:"DelOrderModalComponent",props:["tempOrder"],emits:["updateOrder","closeModal"],setup(f,{expose:y,emit:M}){const{VITE_API:h,VITE_APIPATH:m}=xe,p=f,n=M,t=_(null);function u(){w.delete(`${h}/api/${m}/admin/order/${p.tempOrder.id}`).then(r=>{k("success",r.data.message),n("updateOrder"),n("closeModal")}).catch(r=>{k("error",r.response.data.message)})}return y({delOrderModal:t}),(r,b)=>(d(),c("div",{id:"delOrderModal",ref_key:"delOrderModal",ref:t,class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},[e("div",Ie,[e("div",Ve,[e("div",Ae,[e("h5",Pe,[e("span",null,s(f.tempOrder.id),1)]),we]),e("div",Ee,[e("span",Te,'是否要刪除 "'+s(f.tempOrder.id)+'" 訂單?',1)]),e("div",{class:"modal-footer border-0 justify-content-center"},[Ce,e("button",{type:"button",class:"btn btn-danger w-25",onClick:u}," 確認刪除 ")])])])],512))}};var Le={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Be={class:"container py-144"},De=e("h2",{class:"fw-bold mb-32"},"訂單列表",-1),Ue={class:"table-responsive mb-16"},Ne={class:"table align-middle"},je=e("thead",{class:"text-nowrap"},[e("tr",{class:"text-nowrap text-center border-dark"},[e("th",null," 成立日期 "),e("th",{width:"300"}," 訂單編號 "),e("th",null," 訂購人 "),e("th",null," 手機 "),e("th",null," 訂單內容 "),e("th",null," 總計 "),e("th",null," 付款 "),e("th",null," 編輯 "),e("th",null," 刪除 ")])],-1),Re={class:"text-nowrap text-center"},ze={class:"ps-0 mb-0 list-unstyled text-center"},Fe=["onClick"],qe=e("i",{class:"bi bi-pencil-square fs-5"},null,-1),He=[qe],Je=["onClick"],Ke=e("i",{class:"bi bi-trash3 fs-5"},null,-1),Qe=[Ke],tt={__name:"AdminOrdersView",setup(f){const{VITE_API:y,VITE_APIPATH:M}=Le,h=_([]),m=_({}),p=_({}),n=_(!1);function t(l=1){n.value=!0,w.get(`${y}/api/${M}/admin/orders?page=${l}`).then(i=>{h.value=i.data.orders,p.value=i.data.pagination,n.value=!1}).catch(i=>{n.value=!1,k("error",i.response.data.message)})}const u=_(null),r=_(null);function b(l,i){l==="edit"?(m.value={...i},u.value.editOrderModal.value.show()):l==="delete"&&(m.value={...i},r.value.delOrderModal.value.show())}function E(){m.value={},u.value.resetForm()}function $(){u.value.editOrderModal.value.hide(),r.value.delOrderModal.value.hide()}const v=B(()=>h.value.map(l=>U(l.paid_date*1e3)));return F(()=>{const l=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");w.defaults.headers.common.Authorization=l,u.value.editOrderModal.value=new L(u.value.editOrderModal,{keyboard:!1}),r.value.delOrderModal.value=new L(r.value.delOrderModal,{keyboard:!1}),t()}),(l,i)=>{const T=V("VueLoading");return d(),c(P,null,[O(T,{active:n.value,"onUpdate:active":i[0]||(i[0]=o=>n.value=o),loader:"bars",color:"#ff9900"},null,8,["active"]),e("div",Be,[De,e("div",Ue,[e("table",Ne,[je,e("tbody",Re,[(d(!0),c(P,null,C(h.value,(o,x)=>(d(),c("tr",{key:o.id},[e("td",null,s(o.paid_date?v.value[x]:"未成立"),1),e("td",null,s(o.id),1),e("td",null,s(o.user.name),1),e("td",null,s(o.user.tel),1),e("td",null,[e("ul",ze,[(d(!0),c(P,null,C(o.products,a=>(d(),c("li",{key:a.product_id},s(a.product.title)+" * "+s(a.qty),1))),128))])]),e("td",null,"$ "+s(Math.round(o.total)),1),e("td",null,[e("span",{class:D({"text-danger":o.is_paid===!1})},s(o.is_paid?"已付款":"未付款"),3)]),e("td",null,[e("a",{href:"#",class:"link-primary",onClick:S(a=>b("edit",o),["prevent"])},He,8,Fe)]),e("td",null,[e("a",{href:"#",class:"link-danger",onClick:S(a=>b("delete",o),["prevent"])},Qe,8,Je)])]))),128))])])]),p.value.total_pages>1?(d(),q(H,{key:0,pagination:p.value,onEmitPages:t},null,8,["pagination"])):A("",!0),O($e,{ref_key:"modal",ref:u,"temp-order":m.value,onClearInput:E,onCloseModal:$,onUpdateOrder:t},null,8,["temp-order"]),O(Se,{ref_key:"delModal",ref:r,"temp-order":m.value,onCloseModal:$,onUpdateOrder:t},null,8,["temp-order"])])],64)}}};export{tt as default};
