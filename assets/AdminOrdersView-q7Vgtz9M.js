import{a as v}from"./axios-G2rPRu76.js";import{M as x,A as $}from"./AdminPaginationComponent-oGU6U-BK.js";import{f as V}from"./date-8u4Ux2E5.js";import{s as p}from"./sweetalert-d4GmJCKN.js";import{_ as P,h as i,o as n,c as a,b as e,t as d,i as c,j as w,e as C,f as u,v as b,n as T,T as L,d as O,F as g,r as M,J as S,w as A}from"./index-mH1veyWP.js";var D={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:U,VITE_APIPATH:B}=D,N={props:["tempOrder"],data(){return{order:{},editOrderModal:null}},methods:{updateOrder(){v.put(`${U}/api/${B}/admin/order/${this.tempOrder.id}`,{data:this.order}).then(r=>{p("success",r.data.message),this.$emit("updateOrder"),this.$emit("clearInput"),this.editOrderModal.hide()}).catch(r=>{p("error",r.response.data.message)})},resetForm(){this.$refs.form.resetForm()}},computed:{date(){return V(this.order.paid_date*1e3)}},watch:{tempOrder(){this.order=JSON.parse(JSON.stringify(this.tempOrder))}},mounted(){this.editOrderModal=new x(this.$refs.editOrderModal,{keyboard:!1,backdrop:"static"})}},j={id:"editOrderModal",ref:"editOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-dialog-centered modal-xl"},z={class:"modal-content border-0"},F={class:"modal-header bg-primary text-white"},H={id:"editOrderModalLabel",class:"modal-title"},q={class:"modal-body"},J={class:"h5 fw-bold"},K={class:"d-block d-sm-inline"},Q={class:"h5 fw-bold"},W={class:"row py-24"},Z={class:"col-lg-6"},G={key:0,class:"row gy-16"},X={class:"col-md-6"},Y=e("label",{for:"people",class:"form-label"},"訂購人",-1),ee={class:"col-md-6"},te=e("label",{for:"phone",class:"form-label"},"手機",-1),oe={class:"col-md-6"},se=e("label",{for:"mail",class:"form-label"},"信箱",-1),re={class:"col-md-6"},de=e("label",{for:"address",class:"form-label"},"地址",-1),le={class:"col-12"},ne=e("label",{for:"extarea"},"留言",-1),ae={key:0,class:"col-12"},ie={class:"form-check"},ce=e("label",{class:"form-check-label",for:"check"}," 已付款 ",-1),me={class:"col-lg-6"},_e={key:0},ue=e("hr",{class:"my-8"},null,-1),pe={class:"ps-16 py-8"},he=e("hr",{class:"my-8"},null,-1),fe={class:"modal-footer"},be=e("button",{type:"submit",class:"btn btn-primary text-white w-20"}," 確認 ",-1);function Oe(r,t,h,k,o,l){const m=i("v-field"),y=i("error-message"),I=i("v-form");return n(),a("div",j,[e("div",R,[e("div",z,[e("div",F,[e("h5",H,[e("span",null,d(o.order.id),1)]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=f=>r.$emit("clearInput"))})]),e("div",q,[c(I,{ref:"form",onSubmit:l.updateOrder},{default:w(({errors:f})=>[e("h2",J,[C("訂單編號："),e("span",K,d(o.order.id),1)]),e("h2",Q,"訂單日期："+d(l.date),1),e("div",W,[e("div",Z,[o.order.user?(n(),a("div",G,[e("div",X,[Y,u(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=s=>o.order.user.name=s),readonly:""},null,512),[[b,o.order.user.name]])]),e("div",ee,[te,u(e("input",{id:"phone",type:"tel",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=s=>o.order.user.tel=s),readonly:""},null,512),[[b,o.order.user.tel]])]),e("div",oe,[se,u(e("input",{id:"mail",type:"email",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=s=>o.order.user.email=s),readonly:""},null,512),[[b,o.order.user.email]])]),e("div",re,[de,c(m,{id:"address",name:"地址",type:"text",class:T(["form-control",{"is-invalid":f.地址}]),modelValue:o.order.user.address,"onUpdate:modelValue":t[4]||(t[4]=s=>o.order.user.address=s),rules:"required"},null,8,["modelValue","class"]),c(y,{name:"地址",class:"invalid-feedback"})]),e("div",le,[ne,u(e("textarea",{class:"form-control",id:"extarea",style:{height:"100px"},"onUpdate:modelValue":t[5]||(t[5]=s=>o.order.message=s)},null,512),[[b,o.order.message]])]),o.order.is_paid?O("",!0):(n(),a("div",ae,[e("div",ie,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>o.order.is_paid=s),id:"check"},null,512),[[L,o.order.is_paid]]),ce])]))])):O("",!0)]),e("div",me,[o.order&&o.order.products?(n(),a("div",_e," 訂購內容 ("+d(Object.keys(o.order.products).length)+") ",1)):O("",!0),ue,e("ol",pe,[(n(!0),a(g,null,M(o.order.products,s=>(n(),a("li",{key:s.id},d(s.product.title)+" x "+d(s.qty),1))),128))]),he,e("p",null,"總金額：NT$ "+d(Math.round(o.order.total)),1)])]),e("div",fe,[e("button",{type:"button",class:"btn btn-outline-primary w-20 me-16","data-bs-dismiss":"modal",onClick:t[7]||(t[7]=s=>r.$emit("clearInput"))}," 取消 "),be])]),_:1},8,["onSubmit"])])])])],512)}const ge=P(N,[["render",Oe]]);var ve={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:ye,VITE_APIPATH:Ie}=ve,Me={props:["tempOrder"],data(){return{delOrderModal:null}},methods:{delProduct(){v.delete(`${ye}/api/${Ie}/admin/order/${this.tempOrder.id}`).then(r=>{p("success",r.data.message),this.$emit("updateOrder"),this.delOrderModal.hide()}).catch(r=>{p("error",r.response.data.message)})}},mounted(){this.delOrderModal=new x(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})}},Pe={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},ke={class:"modal-dialog modal-dialog-centered"},Ae={class:"modal-content border-0"},xe={class:"modal-header bg-danger text-white"},Ve={id:"delOrderModalLabel",class:"modal-title"},Te=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ee={class:"modal-body text-center p-24"},$e={class:"fs-5"},we={class:"modal-footer border-0 justify-content-center"},Ce=e("button",{type:"button",class:"btn btn-outline-danger w-25","data-bs-dismiss":"modal"}," 取消 ",-1);function Le(r,t,h,k,o,l){return n(),a("div",Pe,[e("div",ke,[e("div",Ae,[e("div",xe,[e("h5",Ve,[e("span",null,d(h.tempOrder.id),1)]),Te]),e("div",Ee,[e("span",$e,'是否要刪除 "'+d(h.tempOrder.id)+'" 訂單?',1)]),e("div",we,[Ce,e("button",{type:"button",class:"btn btn-danger w-25",onClick:t[0]||(t[0]=(...m)=>l.delProduct&&l.delProduct(...m))}," 確認刪除 ")])])])],512)}const Se=P(Me,[["render",Le]]);var De={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:Ue,VITE_APIPATH:Be}=De,Ne={components:{OrderModalComponent:ge,DelOrderModalComponent:Se,AdminPaginationComponent:$},data(){return{orders:[],tempOrder:{},pagination:{},isLoading:!1}},methods:{getOrders(r=1){this.isLoading=!0,v.get(`${Ue}/api/${Be}/admin/orders?page=${r}`).then(t=>{this.orders=t.data.orders,this.pagination=t.data.pagination,this.isLoading=!1}).catch(t=>{p("error",t.response.data.message)})},openModal(r,t){r==="edit"?(this.tempOrder={...t},this.$refs.modal.editOrderModal.show()):r==="delete"&&(this.tempOrder={...t},this.$refs.delModal.delOrderModal.show())},clearInput(){this.tempOrder={},this.$refs.modal.resetForm()}},computed:{date(){return this.orders.map(r=>V(r.paid_date*1e3))}},mounted(){const r=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");v.defaults.headers.common.Authorization=r,this.getOrders()}},je={class:"container py-144"},Re=e("h2",{class:"fw-bold mb-32"},"訂單列表",-1),ze={class:"table-responsive mb-16"},Fe={class:"table align-middle"},He=e("thead",{class:"text-nowrap"},[e("tr",{class:"text-nowrap text-center border-dark"},[e("th",null," 成立日期 "),e("th",{width:"300"}," 訂單編號 "),e("th",null," 訂購人 "),e("th",null," 手機 "),e("th",null," 訂單內容 "),e("th",null," 總計 "),e("th",null," 付款 "),e("th",null," 編輯 "),e("th",null," 刪除 ")])],-1),qe={class:"text-nowrap text-center"},Je={class:"ps-0 mb-0 list-unstyled text-center"},Ke=["onClick"],Qe=e("i",{class:"bi bi-pencil-square fs-5"},null,-1),We=[Qe],Ze=["onClick"],Ge=e("i",{class:"bi bi-trash3 fs-5"},null,-1),Xe=[Ge];function Ye(r,t,h,k,o,l){const m=i("VueLoading"),y=i("AdminPaginationComponent"),I=i("OrderModalComponent"),f=i("DelOrderModalComponent");return n(),a(g,null,[c(m,{active:o.isLoading,"onUpdate:active":t[0]||(t[0]=s=>o.isLoading=s),loader:"bars",color:"#ff9900"},null,8,["active"]),e("div",je,[Re,e("div",ze,[e("table",Fe,[He,e("tbody",qe,[(n(!0),a(g,null,M(o.orders,(s,E)=>(n(),a("tr",{key:s.id},[e("td",null,d(l.date[E]),1),e("td",null,d(s.id),1),e("td",null,d(s.user.name),1),e("td",null,d(s.user.tel),1),e("td",null,[e("ul",Je,[(n(!0),a(g,null,M(s.products,_=>(n(),a("li",{key:_.product_id},d(_.product.title)+" * "+d(_.qty),1))),128))])]),e("td",null,"$ "+d(Math.round(s.total)),1),e("td",null,[e("span",{class:T({"text-danger":s.is_paid===!1})},d(s.is_paid?"已付款":"未付款"),3)]),e("td",null,[e("a",{href:"#",class:"link-primary",onClick:A(_=>l.openModal("edit",s),["prevent"])},We,8,Ke)]),e("td",null,[e("a",{href:"#",class:"link-danger",onClick:A(_=>l.openModal("delete",s),["prevent"])},Xe,8,Ze)])]))),128))])])]),o.pagination.total_pages>1?(n(),S(y,{key:0,pagination:o.pagination,onEmitPages:l.getOrders},null,8,["pagination","onEmitPages"])):O("",!0),c(I,{ref:"modal","temp-order":o.tempOrder,onClearInput:l.clearInput,onUpdateOrder:l.getOrders},null,8,["temp-order","onClearInput","onUpdateOrder"]),c(f,{ref:"delModal","temp-order":o.tempOrder,onUpdateOrder:l.getOrders},null,8,["temp-order","onUpdateOrder"])])],64)}const dt=P(Ne,[["render",Ye]]);export{dt as default};
