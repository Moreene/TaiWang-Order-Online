import{i as u,C as N,k as A,o as k,c as V,a as e,t as b,l as i,m as R,n as I,e as U,j as D,G as F,w as S,F as O,r as z,f as H,$ as W}from"./index-GZPT54nk.js";import{a as T}from"./axios-G2rPRu76.js";import{s as M,S as J}from"./sweetalert-fB6ucfd0.js";import{f as j,a as q}from"./date-8u4Ux2E5.js";import{M as L}from"./modal-kYRixhNA.js";var K={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Q={class:"modal-dialog modal-dialog-centered modal-lg"},Z={class:"modal-content border-0"},G={class:"modal-header bg-primary text-white"},X={id:"couponModalLabel",class:"modal-title"},Y={class:"modal-body"},ee={class:"row"},te={class:"col-md-6"},oe={class:"mb-16"},ae=e("label",{for:"title",class:"form-label"},"優惠名稱",-1),le={class:"mb-16"},ne=e("label",{for:"code",class:"form-label"},"優惠代碼",-1),se={class:"mb-16"},de=e("label",{for:"percent",class:"form-label"},"優惠%數",-1),ie={class:"col-md-6"},ue={class:"mb-16"},ce=e("label",{for:"date",class:"form-label"},"到期日",-1),re=e("label",{for:"time",class:"form-label"},"到期時間",-1),pe={class:"modal-footer"},me=e("button",{type:"submit",class:"btn btn-primary text-white w-25"}," 確認 ",-1),_e={__name:"CouponModalComponent",props:["tempCoupon","isNew"],emits:["update","clearInput","closeModal"],setup(h,{expose:$,emit:C}){const{VITE_API:f,VITE_APIPATH:r}=K,w=h,p=C,m=u(null),l=u({}),d=u(""),n=u(""),_=u(0),g=u(null);function x(o){return o?o<1?"優惠%數需大於 1 ":!0:"優惠%數 為必填"}function P(){const o=d.value+" "+n.value;_.value=Date.parse(o)}function E(){P();const o={...l.value,is_enabled:l.value.is_enabled?1:0,due_date:_.value};let t=`${f}/api/${r}/admin/coupon/${o.id}`,s="put";w.isNew&&(t=`${f}/api/${r}/admin/coupon`,s="post"),T[s](t,{data:o}).then(a=>{M("success",a.data.message),p("update"),p("clearInput"),p("closeModal")}).catch(a=>{console.log(a),M("error",a.response.data.message)})}function B(){g.value.resetForm()}return N(()=>w.tempCoupon,o=>{d.value=j(o.due_date),n.value=q(o.due_date),Object.assign(l.value,o)},{deep:!0}),$({couponModal:m,resetForm:B}),(o,t)=>{const s=A("v-field"),a=A("error-message"),y=A("v-form");return k(),V("div",{id:"couponModal",ref_key:"couponModal",ref:m,class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",Q,[e("div",Z,[e("div",G,[e("h5",X,b(l.value.title?l.value.title:"建立優惠券"),1),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=c=>o.$emit("clearInput"))})]),i(y,{ref_key:"form",ref:g,onSubmit:E},{default:R(({errors:c})=>[e("div",Y,[e("div",ee,[e("div",te,[e("div",oe,[ae,i(s,{id:"title",name:"優惠名稱",type:"text",class:I(["form-control",{"is-invalid":c.優惠名稱}]),modelValue:l.value.title,"onUpdate:modelValue":t[1]||(t[1]=v=>l.value.title=v),placeholder:"請輸入優惠名稱",rules:"required"},null,8,["modelValue","class"]),i(a,{name:"優惠名稱",class:"invalid-feedback"})]),e("div",le,[ne,i(s,{id:"code",name:"優惠代碼",type:"text",class:I(["form-control",{"is-invalid":c.優惠代碼}]),modelValue:l.value.code,"onUpdate:modelValue":t[2]||(t[2]=v=>l.value.code=v),placeholder:"請輸入優惠代碼",rules:"required"},null,8,["modelValue","class"]),i(a,{name:"優惠代碼",class:"invalid-feedback"})]),e("div",se,[de,i(s,{id:"percent",name:"優惠%數",type:"number",class:I(["form-control",{"is-invalid":c["優惠%數"]}]),modelValue:l.value.percent,"onUpdate:modelValue":t[3]||(t[3]=v=>l.value.percent=v),modelModifiers:{number:!0},placeholder:"請輸入優惠%數",rules:x},null,8,["modelValue","class"]),i(a,{name:"優惠%數",class:"invalid-feedback"})])]),e("div",ie,[e("div",ue,[ce,i(s,{id:"date",name:"到期日",type:"date",class:I(["form-control",{"is-invalid":c.到期日}]),modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=v=>d.value=v),rules:"required"},null,8,["modelValue","class"]),i(a,{name:"到期日",class:"invalid-feedback"})]),e("div",null,[re,i(s,{id:"time",name:"到期時間",type:"time",class:I(["form-control",{"is-invalid":c.到期時間}]),modelValue:n.value,"onUpdate:modelValue":t[5]||(t[5]=v=>n.value=v),rules:"required"},null,8,["modelValue","class"]),i(a,{name:"到期時間",class:"invalid-feedback"})])])])]),e("div",pe,[e("button",{type:"button",class:"btn btn-outline-primary w-25","data-bs-dismiss":"modal",onClick:t[6]||(t[6]=v=>o.$emit("clearInput"))}," 取消 "),me])]),_:1},512)])])],512)}}};var ve={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const fe={class:"modal-dialog modal-dialog-centered"},be={class:"modal-content border-0"},he={class:"modal-header bg-danger text-white"},$e={id:"delCouponModalLabel",class:"modal-title"},Ce=e("i",{class:"bi bi-exclamation-circle"},null,-1),we={class:"modal-body text-center p-24"},ge={class:"fs-5"},Me={class:"modal-footer border-0 justify-content-center"},ye={__name:"DelCouponModalComponent",props:["tempCoupon"],emits:["update","clearInput","closeModal"],setup(h,{expose:$,emit:C}){const{VITE_API:f,VITE_APIPATH:r}=ve,w=h,p=C,m=u(null);function l(){T.delete(`${f}/api/${r}/admin/coupon/${w.tempCoupon.id}`).then(d=>{M("success",d.data.message),p("update"),p("closeModal")}).catch(d=>{console.log(d),M("error",d.response.data.message)})}return $({delCouponModal:m}),(d,n)=>(k(),V("div",{id:"delCouponModal",ref_key:"delCouponModal",ref:m,class:"modal fade",tabindex:"-1","aria-labelledby":"delCouponModalLabel","aria-hidden":"true"},[e("div",fe,[e("div",be,[e("div",he,[e("h5",$e,[e("span",null,[Ce,U(" "+b(h.tempCoupon.title),1)])]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:n[0]||(n[0]=_=>d.$emit("clearInput"))})]),e("div",we,[e("span",ge,'是否要刪除 "'+b(h.tempCoupon.title)+'" 優惠券 ？',1)]),e("div",Me,[e("button",{type:"button",class:"btn btn-outline-danger w-25","data-bs-dismiss":"modal",onClick:n[1]||(n[1]=_=>d.$emit("clearInput"))}," 取消 "),e("button",{type:"button",class:"btn btn-danger w-25",onClick:l}," 確認 ")])])])],512))}};var Ie={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"taiwang",VITE_MAP:"AIzaSyB8xClOZxLQMzkbq6jjN2KlrBmFPPJkvEA",BASE_URL:"/TaiWang-Order-Online/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ke={class:"container py-144"},Ve=e("h2",{class:"fw-bold mb-32"},"優惠列表",-1),xe={class:"text-end mb-24"},Pe=e("i",{class:"bi bi-plus"},null,-1),Ae={class:"table-responsive mb-16"},Te={class:"table align-middle"},Ee=e("thead",{class:"text-nowrap"},[e("tr",{class:"text-nowrap text-center border-dark"},[e("th",{width:"120"}," 優惠名稱 "),e("th",{width:"120"}," 優惠代碼 "),e("th",{width:"120"}," 優惠%數 "),e("th",{width:"120"}," 到期日 "),e("th",{width:"120"}," 到期時間 "),e("th",{width:"100"}," 是否啟用 "),e("th",{width:"120"}," 編輯 "),e("th",{width:"120"}," 刪除 ")])],-1),Be={class:"text-nowrap text-center"},Se={class:"form-check form-switch d-flex justify-content-center"},De=["onUpdate:modelValue","onChange"],Oe=["onClick"],Le=e("i",{class:"bi bi-pencil-square fs-5"},null,-1),Ue=[Le],je=["onClick"],qe=e("i",{class:"bi bi-trash3 fs-5"},null,-1),Ne=[qe],Je={__name:"AdminCouponView",setup(h){const{VITE_API:$,VITE_APIPATH:C}=Ie,f=u([]),r=u({}),w=u({}),p=u(!1),m=u(!1);function l(o=1){m.value=!0,T.get(`${$}/api/${C}/admin/coupons?page=${o}`).then(t=>{w.value=t.data.pagination;const s=t.data.coupons;f.value=s.map(a=>({...a,is_enabled:a.is_enabled===1})),m.value=!1}).catch(t=>{m.value=!1,M("error",t.response.data.message)})}function d(o){const t=!o.is_enabled,s=J.mixin({customClass:{confirmButton:"btn btn-secondary text-light",cancelButton:"btn btn-outline-secondary me-16"},buttonsStyling:!1});s.fire({title:"是否要更新啟用狀態？",icon:"warning",showCancelButton:!0,confirmButtonText:"是, 我要更新",cancelButtonText:"我再想想",reverseButtons:!0}).then(a=>{if(a.isConfirmed){const c={...o,is_enabled:!t?1:0};T.put(`${$}/api/${C}/admin/coupon/${o.id}`,{data:c}).then(()=>{s.fire({title:`已更新 ${o.title} 的啟用狀態`,icon:"success",showConfirmButton:!1,timer:2e3})}).catch(()=>{console.log(err),M("error","更新啟用狀態失敗")})}else o.is_enabled=t})}const n=u(null),_=u(null);function g(o,t){o==="new"?(r.value={},p.value=!0,n.value.couponModal.value.show()):o==="edit"?(r.value={...t},p.value=!1,n.value.couponModal.value.show()):o==="delete"&&(r.value={...t},p.value=!1,_.value.delCouponModal.value.show())}function x(){r.value={due_date:0},n.value.resetForm()}function P(){n.value.couponModal.value.hide(),_.value.delCouponModal.value.hide()}const E=D(()=>f.value.map(o=>j(o.due_date))),B=D(()=>f.value.map(o=>q(o.due_date)));return F(()=>{l(),n.value.couponModal.value=new L(n.value.couponModal,{keyboard:!1}),_.value.delCouponModal.value=new L(_.value.delCouponModal,{keyboard:!1})}),(o,t)=>{const s=A("VueLoading");return k(),V(O,null,[i(s,{active:m.value,"onUpdate:active":t[0]||(t[0]=a=>m.value=a),loader:"bars",color:"#ff9900"},null,8,["active"]),e("div",ke,[Ve,e("div",xe,[e("button",{type:"button",class:"btn btn-primary text-light",onClick:t[1]||(t[1]=S(a=>g("new",o.item),["prevent"]))},[U(" 建立新優惠 "),Pe])]),e("div",Ae,[e("table",Te,[Ee,e("tbody",Be,[(k(!0),V(O,null,z(f.value,(a,y)=>(k(),V("tr",{key:a.id},[e("td",null,b(a.title),1),e("td",null,b(a.code),1),e("td",null,b(a.percent),1),e("td",null,b(E.value[y]),1),e("td",null,b(B.value[y]),1),e("td",null,[e("div",Se,[H(e("input",{class:"form-check-input",type:"checkbox",role:"switch",style:{height:"20px"},"onUpdate:modelValue":c=>a.is_enabled=c,onChange:c=>d(a)},null,40,De),[[W,a.is_enabled]])])]),e("td",null,[e("a",{href:"#",class:"link-primary",onClick:S(c=>g("edit",a),["prevent"])},Ue,8,Oe)]),e("td",null,[e("a",{href:"#",class:"link-danger",onClick:S(c=>g("delete",a),["prevent"])},Ne,8,je)])]))),128))])])])]),i(_e,{ref_key:"modal",ref:n,"temp-coupon":r.value,"is-new":p.value,onClearInput:x,onCloseModal:P,onUpdate:l},null,8,["temp-coupon","is-new"]),i(ye,{ref_key:"delModal",ref:_,"temp-coupon":r.value,onClearInput:x,onCloseModal:P,onUpdate:l},null,8,["temp-coupon"])],64)}}};export{Je as default};
